<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="Generator" content="EditPlus®">
  <meta name="Author" content="">
  <meta name="Keywords" content="">
  <meta name="Description" content="">
  <title>Document</title>
  <link href="../docs.css" type="text/css" rel="stylesheet"></link>
  <script type="text/javascript" src="../../Scripts/yi.core.js"></script>
  <script type="text/javascript" src="../../Scripts/yi.diagnosis.js"></script>
  <script type="text/javascript" src="../../Scripts/yi.assert.helper.js"></script>
 </head>
 <body>
 <h1>yi.Whenable</h1>
 <fieldset class='summary class x-able'>
	<legend>描述</legend>
	带when函数与thenWhen函数的Thenable
 </fieldset>
 <fieldset class='member function'>
	<legend><h2>yi.then</h2></legend>
	<ul><li><h3>Instructions</h3>
	<table class='descriptor'>
		<thead>
			<tr><th colspan="3" class='name'>Description</th></tr>
			<tr><td colspan ="3" class='description'>设定一个异步操作或等待对象(也是异步的resolve)</td></tr>
			<tr><th colspan="3" class='name'>Parameters</th></tr>
			<tr><th class='name'>Name</th><th class='type'>Type</th><th class='description'>Description</th></tr>
			
		</thead>
		<tbody class='parameters'>
			<tr><td class='name'>obj</td><td class='type'>function/Thenable/*</td><td  class='description'>
			<ol>
				<li>当该参数是一个函数时，会异步调用该函数.该函数的this与第一个参数，是本Whenable。第二个参数是when函数的第二个参数。如果该函数执行失败，本Whenable会被拒绝掉，reason是函数抛出的Error</li>
				<li>当该参数是一个Thenable时，会生成该Thenable的包装。里面的Thenable resolve或reject或notify事件会传递给本Whenable</li>
				<li>当该参数是其他类型的值时，会异步的resolve掉本Whenable.</li>
			<ol></td></td>
			
		</tbody>
		<tfoot>
			<tr>
				<th colspan="3"></th>
			</tr>
		</tfoot>
	</table></li>
	<li><script subtype='test'>
$assert.scope(function($assert,log){
var fn = function(d,args){
	$assert.Equal(dfd,this);//$assert.line
	$assert.Equal(dfd,d);//$assert.line
	$assert.Equal("s",args);//$assert.line
	log("execute fn:" + args);
	d.resolve("hello");
	$assert.t=($assert.t||0)+1;//$assert.line
};
$log("when 一个函数");
var dfd = new yi.Whenable();
dfd.name = "dfd";
dfd.when(fn,"s").then(function(value){
	$assert.Equal("hello",value);//$assert.line
	log("dfd is resolved with:" + value);
	$assert.t1=($assert.t1||0)+1;//$assert.line
});
$assert.wait(5).For(function(){return $assert.t1&& $assert.t}).done(function(){
	$assert.Equal(1,$assert.t);//$assert.line
	$assert.Equal(1,$assert.t1);//$assert.line
});

$log("when Thenable");
 
var inner = new yi.Thenable();
inner.name = "inner";
var dfd2 = new yi.Whenable();
dfd2.name = "dfd2";
dfd2.when(inner).then(function(value){
	log("dfd2 was done with value:" + value);
	$assert.Equal(dfd2,this);//$assert.line
	$assert.Equal("inn",value);//$assert.line
	$assert.tx=($assert.tx||0)+1;//$assert.line
});

inner.resolve("inn");
$assert.wait(5).For(function(){return $assert.t1&& $assert.t}).done(function(){
	$assert.Equal(1,$assert.tx);//$assert.line
});

});
	</script></li>
	</ul>
 </fieldset>
 </body>
</html>
